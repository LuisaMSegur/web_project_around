!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var r=document.querySelector("#card-template").content,o=function(){return e=function e(t){var n=t.data,r=t.handleClickImage,o=t.handleClickDelete,i=t.handleLikes,u=t.userId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n.name,this.link=n.link,this.owner=n.owner,this.likes=n.likes||[],this.isLiked=this.isLikedByUser(),this.id=n._id,this.userId=u,this.handleClickImage=r,this.handleClickDelete=o,this.handleLikes=i,this.setProperties()},(n=[{key:"getTemplate",value:function(){return r.querySelector(".card").cloneNode(!0)}},{key:"setProperties",value:function(){this.htmlCard=this.getTemplate(),this.cardImage=this.htmlCard.querySelector(".card__photo"),this.cardTitle=this.htmlCard.querySelector(".card__name-place"),this.buttonLikeCard=this.htmlCard.querySelector(".card__button-love"),this.buttonDeleteCard=this.htmlCard.querySelector(".card__button-trash"),this.counterLikes=this.htmlCard.querySelector(".card__like"),this.cardTitle.textContent=this.name,this.cardImage.src=this.link,this.counterLikes.textContent=this.likes.length,this.updateLikeButton(),this.owner._id===this.userId?this.buttonDeleteCard.style.display="block":this.buttonDeleteCard.style.display="none"}},{key:"isLikedByUser",value:function(){var e=this;return this.likes.some((function(t){return t._id===e.userId}))}},{key:"toggleLike",value:function(e){this.likes=e,this.isLiked=this.isLikedByUser(),this.counterLikes.textContent=e.length,this.updateLikeButton()}},{key:"updateLikeButton",value:function(){this.isLiked=this.isLikedByUser(),this.buttonLikeCard.classList.toggle("card__button-love_active",this.isLiked)}},{key:"removeCard",value:function(){this.htmlCard.remove()}},{key:"setEventListeners",value:function(){var e=this;this.cardImage.addEventListener("click",(function(){e.handleClickImage()})),this.buttonDeleteCard.addEventListener("click",(function(){e.handleClickDelete(e.id)})),this.buttonLikeCard.addEventListener("click",(function(){e.handleLikes(e.id,e.isLiked).then((function(t){e.toggleLike(t.likes)})).catch((function(e){return console.error("Error al hacer toggleLike:",e)}))}))}},{key:"closeOnEsc",value:function(e){"Escape"===e.key&&this.closePopUpImage()}},{key:"closeClickOutForm",value:function(e,t){t.target===e&&this.closePopUpImage()}},{key:"openPopUpImage",value:function(){var e=this,t=document.querySelector("#popup-image"),n=t.querySelector(".popup__photo"),r=t.querySelector(".popup__photo-title");t.classList.add("popup_open"),r.textContent=this.name,n.src=this.link,document.addEventListener("keydown",this.closeOnEsc.bind(this)),document.addEventListener("click",(function(n){return e.closeClickOutForm(t,n)}))}},{key:"closePopUpImage",value:function(){document.querySelector("#popup-image").classList.remove("popup_open"),document.removeEventListener("keydown",this.closeOnEsc.bind(this))}},{key:"setCard",value:function(){return this.setProperties(),this.setEventListeners(),this.htmlCard}}])&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}var a=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.formElement=t,this.settings=n,this.inputList=Array.from(this.formElement.querySelectorAll(this.settings.inputSelector)),this.buttonElement=this.formElement.querySelector(this.settings.submitButtonSelector)},(t=[{key:"showInputError",value:function(e,t){var n=this.formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this.settings.inputErrorClass),n.textContent=t,n.classList.add(this.settings.errorClass)}},{key:"hideInputError",value:function(e){var t=this.formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this.settings.inputErrorClass),t.textContent="",t.classList.remove(this.settings.errorClass)}},{key:"checkInputValidity",value:function(e){e.validity.valid?this.hideInputError(e):this.showInputError(e,e.validationMessage)}},{key:"hasInvalidInput",value:function(){return this.inputList.some((function(e){return!e.validity.valid}))}},{key:"toggleButtonState",value:function(){this.hasInvalidInput()?(this.buttonElement.disabled=!0,this.buttonElement.classList.add(this.settings.inactiveButtonClass)):(this.buttonElement.disabled=!1,this.buttonElement.classList.remove(this.settings.inactiveButtonClass))}},{key:"setEventListeners",value:function(){var e=this;this.toggleButtonState(),this.inputList.forEach((function(t){t.addEventListener("input",(function(){e.checkInputValidity(t),e.toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this.formElement.addEventListener("submit",(function(e){e.preventDefault()})),this.setEventListeners()}}])&&u(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),s={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"},l=document.querySelector("#form-profile"),f=document.querySelector(".profile__title"),p=document.querySelector(".profile__subtitle"),y=document.querySelector("#avatar"),h=document.querySelector("#form-avatar"),d=document.querySelector("#form-card"),m=document.querySelector(".profile__button"),b=document.querySelector(".profile__button-add"),v=document.querySelector(".profile__photo_edit");function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,E(r.key),r)}}function E(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var S=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.popupElement=document.querySelector(t),this.closeButton=this.popupElement.querySelector(".popup__close"),this._handleEsClose=this._handleEsClose.bind(this)},(t=[{key:"openPopup",value:function(){this.popupElement.classList.add("popup_open"),document.addEventListener("keydown",this._handleEsClose)}},{key:"closePopup",value:function(){this.popupElement.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEsClose)}},{key:"_handleEsClose",value:function(e){"Escape"===e.key&&this.closePopup()}},{key:"handleClickOutside",value:function(e){return e.target.classList.contains("popup_open")}},{key:"setEventListeners",value:function(){var e=this;this.closeButton.addEventListener("click",(function(){e.closePopup()})),this.popupElement.addEventListener("click",(function(t){e.handleClickOutside(t)&&e.closePopup()}))}}])&&g(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function j(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}function O(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(O=function(){return!!e})()}function C(e,t,n,r){var o=_(L(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}function _(){return _="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},_.apply(null,arguments)}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}function I(e,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},I(e,t)}var T=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,n){return t=L(t),function(e,t){if(t&&("object"==w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,O()?Reflect.construct(t,n||[],L(e).constructor):t.apply(e,n))}(this,t,[e])).formElement=r.popupElement.querySelector(".form"),r.inputList=r.formElement.querySelectorAll(".form__input"),r.handleFormSubmit=n,r.buttonSubmit=r.formElement.querySelector(".form__submit"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&I(e,t)}(t,e),n=t,(r=[{key:"getInputValues",value:function(){var e=this;return this.formValues={},this.inputList.forEach((function(t){e.formValues[t.name]=t.value})),this.formValues}},{key:"setEventListeners",value:function(){var e=this;C(t,"setEventListeners",this,3)([]),this.formElement.addEventListener("submit",(function(t){t.preventDefault(),e.handleFormSubmit(e.getInputValues()),e.closePopup()})),this.buttonSubmit.addEventListener("click",(function(){e.buttonSubmit.textContent="Cargando..."}))}},{key:"closePopup",value:function(){C(t,"closePopup",this,3)([]),this.formElement.reset()}}])&&P(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(S);function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,B(r.key),r)}}function B(e){var t=function(e){if("object"!=q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==q(t)?t:t+""}function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(D=function(){return!!e})()}function R(){return R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},R.apply(null,arguments)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}var V=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=x(t),function(e,t){if(t&&("object"==q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,D()?Reflect.construct(t,n||[],x(e).constructor):t.apply(e,n))}(this,t,[e])).imageElement=n.popupElement.querySelector(".popup__photo"),n.titleElement=n.popupElement.querySelector(".popup__photo-title"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(t,e),n=t,r=[{key:"openPopup",value:function(e,n){var r,o,i;(r=t,o=this,"function"==typeof(i=R(x(1&3?r.prototype:r),"openPopup",o))?function(e){return i.apply(o,e)}:i)([]),this.titleElement.textContent=e,this.imageElement.src=n}}],r&&U(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(S);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,J(r.key),r)}}function J(e){var t=function(e){if("object"!=F(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==F(t)?t:t+""}var G=function(){return e=function e(t){var n=t.name,r=t.about,o=t.avatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n,this.about=r,this.avatar=o,this.userId=null},(t=[{key:"getUserInfo",value:function(){return{name:this.name.textContent,about:this.about.textContent,avatar:this.avatar.src,userId:this.userId}}},{key:"setUserInfo",value:function(e,t,n){this.name.textContent=e,this.about.textContent=t,this.userId=n}},{key:"setUserAvatar",value:function(e){this.avatar.src=e}}])&&N(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,M(r.key),r)}}function M(e){var t=function(e){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==H(t)?t:t+""}var K=function(){return e=function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=Array.isArray(r)?r:[],this.renderer=o,this.container=document.querySelector(n)},(t=[{key:"renderItems",value:function(){var e=this;this.items.forEach((function(t){e.renderer(t)}))}},{key:"addCard",value:function(e){this.container.append(e)}}])&&z(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return(t=$(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$(r.key),r)}}function $(e){var t=function(e){if("object"!=Q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Q(t)?t:t+""}var ee=new(function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=t,this.headers=n},(t=[{key:"getUser",value:function(){return fetch("".concat(this.baseUrl,"/users/me"),{method:"GET",headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"editUser",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:X({"Content-Type":"application/json"},this.headers),body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"editAvatar",value:function(e){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:X({"Content-Type":"application/json"},this.headers),body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"getCards",value:function(){return fetch("".concat(this.baseUrl,"/cards"),{method:"GET",headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"createCard",value:function(e,t){return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:X(X({},this.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"likeCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"dislikeCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("error en la petición")}))}},{key:"toggleLike",value:function(e,t){return t?this.dislikeCard(e):this.likeCard(e)}}])&&Z(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}())("https://around.nomoreparties.co/v1/web-es-cohort-16",{authorization:"8a4f71dd-3b26-4bfa-a79c-46527c68df13"});function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,re(r.key),r)}}function re(e){var t=function(e){if("object"!=te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==te(t)?t:t+""}function oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(oe=function(){return!!e})()}function ie(){return ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=ue(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ie.apply(null,arguments)}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ue(e)}function ce(e,t){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(e,t)}var ae=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=ue(t),function(e,t){if(t&&("object"==te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,oe()?Reflect.construct(t,n||[],ue(e).constructor):t.apply(e,n))}(this,t,[e])).action=function(){},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ce(e,t)}(t,e),n=t,r=[{key:"setAction",value:function(e){this.action=e}},{key:"setEventListeners",value:function(){var e,n,r,o=this;(e=t,n=this,"function"==typeof(r=ie(ue(1&3?e.prototype:e),"setEventListeners",n))?function(e){return r.apply(n,e)}:r)([]);var i=this.popupElement.querySelector("#buttonConfirmation");i?i.addEventListener("click",(function(){o.action()})):console.error("El botón de confirmación no se encontró en el popup.")}}],r&&ne(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(S),se=new G({name:f,about:p,avatar:y});ee.getUser().then((function(e){se.setUserInfo(e.name,e.about,e._id),se.setUserAvatar(e.avatar)})).catch((function(e){console.log(e)}));var le=new T("#popup-profile",(function(e){ee.editUser(e.name,e.about).then((function(e){se.setUserInfo(e.name,e.about)})).catch((function(e){console.log(e)}))}));le.setEventListeners(),m.addEventListener("click",(function(){le.openPopup()}));var fe=new T("#popup-avatar",(function(e){ee.editAvatar(e.avatar).then((function(e){se.setUserAvatar(e.avatar)})).catch((function(e){console.log(e)}))}));fe.setEventListeners(),v.addEventListener("click",(function(){fe.openPopup()})),ee.getCards().then((function(e){pe.items=e,pe.renderItems()})).catch((function(e){console.log(e)}));var pe=new K({items:[],renderer:function(e){var t=new o({data:e,handleClickImage:function(){de.openPopup({name:e.name,link:e.link})},handleClickDelete:function(e){he.openPopup(),he.setAction((function(){ee.deleteCard(e).then((function(){t.removeCard(),he.closePopup()}))}))},handleLikes:function(e,n){return ee.toggleLike(e,n).then((function(e){return t.toggleLike(e.likes),e}))},userId:se.userId});pe.addCard(t.setCard())}},".cards"),ye=new T("#popup-card",(function(e){ee.createCard(e.title,e.link).then((function(e){var t=new o({data:e,handleClickImage:function(){de.openPopup(e.name,e.link)},handleClickDelete:function(e){he.openPopup(),he.setAction((function(){ee.deleteCard(e).then((function(){t.removeCard(),he.closePopup()}))}))},handleLikes:function(e,n){return ee.toggleLike(e,n).then((function(e){return t.toggleLike(e.likes),e}))},userId:se.userId});pe.addCard(t.setCard()),ye.closePopup()})).catch((function(){return console.log("error al crear carta")}))})),he=new ae("#popup-deleteCard");he.setEventListeners(),ye.setEventListeners(),b.addEventListener("click",(function(){ye.openPopup()}));var de=new V("#popup-image");de.setEventListeners();var me=new a(l,s),be=new a(d,s),ve=new a(h,s);me.enableValidation(),be.enableValidation(),ve.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNRSxRQUFRcUgsSUFBSSx1QkFBdUIsR0FDeEQsSUFFTVksR0FBa0IsSUFBSW5CLEdBQXNCLHFCQUNsRG1CLEdBQWdCbEgsb0JBRWhCd0gsR0FBVXhILG9CQUNWcUMsRUFBYzFELGlCQUFpQixTQUFTLFdBQ3BDNkksR0FBVWQsV0FDZCxJQUVBLElBQU1PLEdBQWEsSUFBSXZELEVBQWUsZ0JBQ3RDdUQsR0FBV2pILG9CQUlYLElBQU0wSCxHQUFvQixJQUFJekgsRUFBYzZCLEVBQWEzQixHQUNuRHdILEdBQXFCLElBQUkxSCxFQUFja0MsRUFBYWhDLEdBQ3BEeUgsR0FBdUIsSUFBSTNILEVBQWNpQyxFQUFnQi9CLEdBQy9EdUgsR0FBa0JHLG1CQUNsQkYsR0FBbUJFLG1CQUNuQkQsR0FBcUJDLGtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9hcm91bmQvLi9zcmMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy9zY3JpcHRzL3V0aWxzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy9zY3JpcHRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy9zY3JpcHRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9hcm91bmQvLi9zcmMvc2NyaXB0cy9hcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIikuY29udGVudDtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3Ioe1xyXG4gICAgICAgIGRhdGEsXHJcbiAgICAgICAgaGFuZGxlQ2xpY2tJbWFnZSxcclxuICAgICAgICBoYW5kbGVDbGlja0RlbGV0ZSxcclxuICAgICAgICBoYW5kbGVMaWtlcyxcclxuICAgICAgICB1c2VySWQsXHJcbiAgICB9KSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgICAgIHRoaXMubGluayA9IGRhdGEubGluaztcclxuICAgICAgICB0aGlzLm93bmVyID0gZGF0YS5vd25lcjtcclxuICAgICAgICB0aGlzLmxpa2VzID0gZGF0YS5saWtlcyB8fCBbXTtcclxuICAgICAgICB0aGlzLmlzTGlrZWQgPSB0aGlzLmlzTGlrZWRCeVVzZXIoKTtcclxuICAgICAgICB0aGlzLmlkID0gZGF0YS5faWQ7XHJcbiAgICAgICAgdGhpcy51c2VySWQgPSB1c2VySWQ7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVDbGlja0ltYWdlID0gaGFuZGxlQ2xpY2tJbWFnZTtcclxuICAgICAgICB0aGlzLmhhbmRsZUNsaWNrRGVsZXRlID0gaGFuZGxlQ2xpY2tEZWxldGU7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVMaWtlcyA9IGhhbmRsZUxpa2VzO1xyXG4gICAgICAgIHRoaXMuc2V0UHJvcGVydGllcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFRlbXBsYXRlKCkge1xyXG4gICAgICAgIHJldHVybiBjYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQcm9wZXJ0aWVzKCkge1xyXG4gICAgICAgIHRoaXMuaHRtbENhcmQgPSB0aGlzLmdldFRlbXBsYXRlKCk7XHJcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UgPSB0aGlzLmh0bWxDYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fcGhvdG9cIik7XHJcbiAgICAgICAgdGhpcy5jYXJkVGl0bGUgPSB0aGlzLmh0bWxDYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbmFtZS1wbGFjZVwiKTtcclxuICAgICAgICB0aGlzLmJ1dHRvbkxpa2VDYXJkID0gdGhpcy5odG1sQ2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2J1dHRvbi1sb3ZlXCIpO1xyXG4gICAgICAgIHRoaXMuYnV0dG9uRGVsZXRlQ2FyZCA9IHRoaXMuaHRtbENhcmQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgICAgXCIuY2FyZF9fYnV0dG9uLXRyYXNoXCJcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuY291bnRlckxpa2VzID0gdGhpcy5odG1sQ2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2VcIik7XHJcbiAgICAgICAgdGhpcy5jYXJkVGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLm5hbWU7XHJcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2Uuc3JjID0gdGhpcy5saW5rO1xyXG4gICAgICAgIHRoaXMuY291bnRlckxpa2VzLnRleHRDb250ZW50ID0gdGhpcy5saWtlcy5sZW5ndGg7XHJcbiAgICAgICAgdGhpcy51cGRhdGVMaWtlQnV0dG9uKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm93bmVyLl9pZCA9PT0gdGhpcy51c2VySWQpIHtcclxuICAgICAgICAgICAgdGhpcy5idXR0b25EZWxldGVDYXJkLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7ICBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbkRlbGV0ZUNhcmQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzTGlrZWRCeVVzZXIoKSB7IFxyXG4gICAgICAgIGNvbnN0IGxpa2VkQnlVc2VyID0gdGhpcy5saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy51c2VySWQpO1xyXG4gICAgICAgIHJldHVybiBsaWtlZEJ5VXNlcjtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVMaWtlKGxpa2VzKSB7XHJcbiAgICAgICAgdGhpcy5saWtlcyA9IGxpa2VzO1xyXG4gICAgICAgIHRoaXMuaXNMaWtlZCA9IHRoaXMuaXNMaWtlZEJ5VXNlcigpO1xyXG4gICAgICAgIHRoaXMuY291bnRlckxpa2VzLnRleHRDb250ZW50ID0gbGlrZXMubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMudXBkYXRlTGlrZUJ1dHRvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUxpa2VCdXR0b24oKSB7XHJcbiAgICAgICAgdGhpcy5pc0xpa2VkID0gdGhpcy5pc0xpa2VkQnlVc2VyKCk7XHJcbiAgICAgICAgdGhpcy5idXR0b25MaWtlQ2FyZC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fYnV0dG9uLWxvdmVfYWN0aXZlXCIsIHRoaXMuaXNMaWtlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlQ2FyZCgpIHtcclxuICAgICAgICB0aGlzLmh0bWxDYXJkLnJlbW92ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2xpY2tJbWFnZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYnV0dG9uRGVsZXRlQ2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZUNsaWNrRGVsZXRlKHRoaXMuaWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYnV0dG9uTGlrZUNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVMaWtlcyh0aGlzLmlkLCB0aGlzLmlzTGlrZWQpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgdGhpcy50b2dnbGVMaWtlKHJlcy5saWtlcyk7IFxyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgaGFjZXIgdG9nZ2xlTGlrZTpcIiwgZXJyKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VPbkVzYyhldnQpIHtcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlUG9wVXBJbWFnZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbG9zZUNsaWNrT3V0Rm9ybShwb3B1cCwgZXZ0KSB7XHJcbiAgICAgICAgaWYgKGV2dC50YXJnZXQgPT09IHBvcHVwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VQb3BVcEltYWdlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb3BlblBvcFVwSW1hZ2UoKSB7XHJcbiAgICAgICAgY29uc3QgcG9wVXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtaW1hZ2VcIik7XHJcbiAgICAgICAgY29uc3QgcG9wVXBJbWFnZVNyYyA9IHBvcFVwSW1hZ2UucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fcGhvdG9cIik7XHJcbiAgICAgICAgY29uc3QgUG9wVXBUaXRsZUltYWdlID0gcG9wVXBJbWFnZS5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19waG90by10aXRsZVwiKTtcclxuXHJcbiAgICAgICAgcG9wVXBJbWFnZS5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlblwiKTtcclxuICAgICAgICBQb3BVcFRpdGxlSW1hZ2UudGV4dENvbnRlbnQgPSB0aGlzLm5hbWU7XHJcbiAgICAgICAgcG9wVXBJbWFnZVNyYy5zcmMgPSB0aGlzLmxpbms7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuY2xvc2VPbkVzYy5iaW5kKHRoaXMpKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT5cclxuICAgICAgICAgICAgdGhpcy5jbG9zZUNsaWNrT3V0Rm9ybShwb3BVcEltYWdlLCBldnQpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuICAgIGNsb3NlUG9wVXBJbWFnZSgpIHtcclxuICAgICAgICBjb25zdCBwb3BVcEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cC1pbWFnZVwiKTtcclxuICAgICAgICBwb3BVcEltYWdlLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuXCIpO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmNsb3NlT25Fc2MuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q2FyZCgpIHtcclxuICAgICAgICB0aGlzLnNldFByb3BlcnRpZXMoKTtcclxuICAgICAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHRtbENhcmQ7XHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihmb3JtRWxlbWVudCwgc2V0dGluZ3MpIHtcclxuICAgICAgICAodGhpcy5mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50KSwgKHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncyk7XHJcbiAgICAgICAgdGhpcy5pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICAgIHRoaXMuZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNldHRpbmdzLmlucHV0U2VsZWN0b3IpXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLmJ1dHRvbkVsZW1lbnQgPSB0aGlzLmZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLmZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICAgICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MpO1xyXG4gICAgfVxyXG4gICAgaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICAgICApO1xyXG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyk7XHJcbiAgICB9XHJcbiAgICBjaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBoYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgICAgICB0aGlzLmZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xyXG4gICAgZm9ybVNlbGVjdG9yOiBcIi5mb3JtXCIsXHJcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5mb3JtX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLmZvcm1fX3N1Ym1pdFwiLFxyXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJmb3JtX19zdWJtaXRfZGlzYWJsZWRcIixcclxuICAgIGlucHV0RXJyb3JDbGFzczogXCJmb3JtX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgICBlcnJvckNsYXNzOiBcImZvcm1fX2Vycm9yX3Zpc2libGVcIixcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBmb3JtUHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZm9ybS1wcm9maWxlXCIpO1xyXG5leHBvcnQgY29uc3QgdGV4dFRpdGxlUHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XHJcbmV4cG9ydCBjb25zdCB0ZXh0U3VidGl0bGVQcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19zdWJ0aXRsZVwiKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyXCIpO1xyXG5leHBvcnQgY29uc3QgZm9ybUVkaXRBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Zvcm0tYXZhdGFyXCIpXHJcbmV4cG9ydCBjb25zdCBmb3JtQWRkQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZm9ybS1jYXJkXCIpO1xyXG5leHBvcnQgY29uc3QgYnV0dG9uRWRpdFByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvblwiKTtcclxuZXhwb3J0IGNvbnN0IGJ1dHRvbkFkZENhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvbi1hZGRcIik7XHJcbmV4cG9ydCBjb25zdCBidXR0b25FZGl0QXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19waG90b19lZGl0XCIpO1xyXG5cclxuXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgICAgICB0aGlzLnBvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5jbG9zZUJ1dHRvbiA9IHRoaXMucG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlXCIpO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUVzQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlblBvcHVwKCkge1xyXG4gICAgICAgIHRoaXMucG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuXCIpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzQ2xvc2UpO1xyXG4gICAgfVxyXG4gICAgY2xvc2VQb3B1cCgpIHtcclxuICAgICAgICB0aGlzLnBvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlblwiKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc0Nsb3NlKTtcclxuICAgIH1cclxuICAgIF9oYW5kbGVFc0Nsb3NlKGV2dCkge1xyXG4gICAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VQb3B1cCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGhhbmRsZUNsaWNrT3V0c2lkZShldnQpIHtcclxuICAgICAgICByZXR1cm4gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuXCIpO1xyXG4gICAgfVxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlUG9wdXAoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnBvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5oYW5kbGVDbGlja091dHNpZGUoZXZ0KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVBvcHVwKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSAnLi9Qb3B1cC5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXB7XHJcbmNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpe1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLmZvcm1FbGVtZW50ID0gdGhpcy5wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xyXG4gICAgdGhpcy5pbnB1dExpc3QgPSB0aGlzLmZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybV9faW5wdXRcIik7XHJcbiAgICB0aGlzLmhhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0OyAgXHJcbiAgICB0aGlzLmJ1dHRvblN1Ym1pdCA9IHRoaXMuZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtX19zdWJtaXRcIik7XHJcbn1cclxuXHJcbiBnZXRJbnB1dFZhbHVlcygpe1xyXG4gdGhpcy5mb3JtVmFsdWVzID0ge307XHJcbiB0aGlzLmlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCk9PntcclxuICAgICB0aGlzLmZvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuIH0pO1xyXG4gcmV0dXJuIHRoaXMuZm9ybVZhbHVlczsgIFxyXG4gfVxyXG5cclxuXHJcbnNldEV2ZW50TGlzdGVuZXJzKCl7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIHRoaXMuZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KT0+e1xyXG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlRm9ybVN1Ym1pdCh0aGlzLmdldElucHV0VmFsdWVzKCkpO1xyXG4gICAgICAgIHRoaXMuY2xvc2VQb3B1cCgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmJ1dHRvblN1Ym1pdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICB0aGlzLmJ1dHRvblN1Ym1pdC50ZXh0Q29udGVudCA9IFwiQ2FyZ2FuZG8uLi5cIjtcclxuICAgIH0pO1xyXG4gfVxyXG5cclxuIGNsb3NlUG9wdXAoKXtcclxuICAgICBzdXBlci5jbG9zZVBvcHVwKCk7XHJcbiAgICAgdGhpcy5mb3JtRWxlbWVudC5yZXNldCgpO1xyXG59XHJcblxyXG59XHJcblxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcil7XHJcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3RvcilcclxuICAgICAgICB0aGlzLmltYWdlRWxlbWVudCA9IHRoaXMucG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3Bob3RvXCIpO1xyXG4gICAgICAgIHRoaXMudGl0bGVFbGVtZW50ID0gdGhpcy5wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fcGhvdG8tdGl0bGVcIik7XHJcblxyXG4gICAgfVxyXG4gICAgb3BlblBvcHVwKHRpdGxlLCBsaW5rKXtcclxuICAgICAgICBzdXBlci5vcGVuUG9wdXAoKTtcclxuICAgICAgICB0aGlzLnRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHRpdGxlO1xyXG4gICAgICAgIHRoaXMuaW1hZ2VFbGVtZW50LnNyYyA9IGxpbms7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgICBjb25zdHJ1Y3Rvcih7IG5hbWUsIGFib3V0LCBhdmF0YXJ9KSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmFib3V0ID0gYWJvdXQ7XHJcbiAgICAgICAgdGhpcy5hdmF0YXIgPSBhdmF0YXI7XHJcbiAgICAgICAgdGhpcy51c2VySWQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLnRleHRDb250ZW50LFxyXG4gICAgICAgICAgICBhYm91dDogdGhpcy5hYm91dC50ZXh0Q29udGVudCxcclxuICAgICAgICAgICAgYXZhdGFyOiB0aGlzLmF2YXRhci5zcmMsXHJcbiAgICAgICAgICAgIHVzZXJJZDogdGhpcy51c2VySWQsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHNldFVzZXJJbmZvKGlucHV0TmFtZSwgaW5wdXRBYm91dCwgdXNlcklkKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lLnRleHRDb250ZW50ID0gaW5wdXROYW1lO1xyXG4gICAgICAgIHRoaXMuYWJvdXQudGV4dENvbnRlbnQgPSBpbnB1dEFib3V0O1xyXG4gICAgICAgIHRoaXMudXNlcklkID0gdXNlcklkO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHNldFVzZXJBdmF0YXIoaW5wdXRBdmF0YXIpe1xyXG4gICAgICAgIHRoaXMuYXZhdGFyLnNyYyA9IGlucHV0QXZhdGFyO1xyXG4gICAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb257XHJcbiAgICBjb25zdHJ1Y3Rvcih7aXRlbXMsIHJlbmRlcmVyfSwgY29udGFpbmVyU2VsZWN0b3Ipe1xyXG4gICAgICAgIHRoaXMuaXRlbXMgPSBBcnJheS5pc0FycmF5KGl0ZW1zKSA/IGl0ZW1zIDogW107XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVySXRlbXMoKXtcclxuICAgICAgICB0aGlzLml0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlcihpdGVtKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICBcclxuXHJcbiAgICBhZGRDYXJkKGVsZW1lbnQpe1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChlbGVtZW50KTtcclxuICAgIH1cclxufVxyXG5cclxuIiwiY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKGJhc2VVcmwsIGhlYWRlcnMpIHtcclxuICAgICAgICB0aGlzLmJhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlcigpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYGVycm9yIGVuIGxhIHBldGljacOzbmApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRVc2VyKG5hbWUsIGFib3V0KSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiwgXHJcbiAgICAgICAgICAgICAgICAuLi50aGlzLmhlYWRlcnMsIFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICAgICAgYWJvdXQsIFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgZXJyb3IgZW4gbGEgcGV0aWNpw7NuYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZWRpdEF2YXRhcihsaW5rKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsIFxyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5oZWFkZXJzLCBcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgYXZhdGFyOiBsaW5rLCBcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYGVycm9yIGVuIGxhIHBldGljacOzbmApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENhcmRzKCkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgZXJyb3IgZW4gbGEgcGV0aWNpw7NuYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ2FyZChuYW1lLCBsaW5rKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgIC4uLnRoaXMuaGVhZGVycyxcclxuICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICAgICAgbGluayxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYGVycm9yIGVuIGxhIHBldGljacOzbmApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgZXJyb3IgZW4gbGEgcGV0aWNpw7NuYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgZXJyb3IgZW4gbGEgcGV0aWNpw7NuYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5vaykgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgZXJyb3IgZW4gbGEgcGV0aWNpw7NuYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlTGlrZShjYXJkSWQsIGlzbGlrZWQpIHtcclxuICAgICAgICByZXR1cm4gaXNsaWtlZCA/IHRoaXMuZGlzbGlrZUNhcmQoY2FyZElkKSA6IHRoaXMubGlrZUNhcmQoY2FyZElkKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoXHJcbiAgICBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvd2ViLWVzLWNvaG9ydC0xNlwiLFxyXG4gICAge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IFwiOGE0ZjcxZGQtM2IyNi00YmZhLWE3OWMtNDY1MjdjNjhkZjEzXCIsXHJcbiAgICB9XHJcbik7XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xyXG5jb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKXtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5hY3Rpb24gPSAoKT0+e307XHJcbn1cclxuc2V0QWN0aW9uKGFjdGlvbil7XHJcbiAgICB0aGlzLmFjdGlvbiA9IGFjdGlvbjtcclxufVxyXG5zZXRFdmVudExpc3RlbmVycygpe1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSB0aGlzLnBvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbkNvbmZpcm1hdGlvblwiKTtcclxuICAgIGlmIChjb25maXJtQnV0dG9uKSB7XHJcbiAgICAgICAgY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRWwgYm90w7NuIGRlIGNvbmZpcm1hY2nDs24gbm8gc2UgZW5jb250csOzIGVuIGVsIHBvcHVwLlwiKTtcclxuICAgIH1cclxufVxyXG59IiwiaW1wb3J0IFwiLi9zdHlsZXMvaW5kZXguY3NzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuL3NjcmlwdHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi9zY3JpcHRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IHtcclxuICAgIHNldHRpbmdzLFxyXG4gICAgZm9ybVByb2ZpbGUsXHJcbiAgICB0ZXh0VGl0bGVQcm9maWxlLFxyXG4gICAgdGV4dFN1YnRpdGxlUHJvZmlsZSxcclxuICAgIGF2YXRhcixcclxuICAgIGZvcm1FZGl0QXZhdGFyLFxyXG4gICAgZm9ybUFkZENhcmQsXHJcbiAgICBidXR0b25FZGl0UHJvZmlsZSxcclxuICAgIGJ1dHRvbkFkZENhcmQsXHJcbiAgICBidXR0b25FZGl0QXZhdGFyLFxyXG59IGZyb20gXCIuL3NjcmlwdHMvdXRpbHMuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4vc2NyaXB0cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi9zY3JpcHRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi9zY3JpcHRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuL3NjcmlwdHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBhcGkgfSBmcm9tIFwiLi9zY3JpcHRzL2FwaS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuL3NjcmlwdHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzXCI7XHJcblxyXG4vL2luc3RhbmNpYSBwYXJhIG9idGVuZXIgbGEgaW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvXHJcblxyXG5jb25zdCBuZXdVc2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XHJcbiAgICBuYW1lOiB0ZXh0VGl0bGVQcm9maWxlLFxyXG4gICAgYWJvdXQ6IHRleHRTdWJ0aXRsZVByb2ZpbGUsXHJcbiAgICBhdmF0YXI6IGF2YXRhcixcclxufSk7XHJcblxyXG5hcGkuZ2V0VXNlcigpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIG5ld1VzZXJJbmZvLnNldFVzZXJJbmZvKGRhdGEubmFtZSwgZGF0YS5hYm91dCwgZGF0YS5faWQpO1xyXG4gICAgICAgIG5ld1VzZXJJbmZvLnNldFVzZXJBdmF0YXIoZGF0YS5hdmF0YXIpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG5cclxuLy9pbnN0YW5jaWFzIHkgZXZlbnRvcyBwYXJhIGVkaXRhciBlbCBwZXJmaWwgKG5vbWJyZSwgcHJvZmVzacOzbiB5IGF2YXRhcilcclxuXHJcbmNvbnN0IHBvcHVwUHJvZmlsZSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3BvcHVwLXByb2ZpbGVcIiwgKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBhcGkuZWRpdFVzZXIoaW5wdXRWYWx1ZXMubmFtZSwgaW5wdXRWYWx1ZXMuYWJvdXQpXHJcbiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgbmV3VXNlckluZm8uc2V0VXNlckluZm8oZGF0YS5uYW1lLCBkYXRhLmFib3V0KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5wb3B1cFByb2ZpbGUuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYnV0dG9uRWRpdFByb2ZpbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHBvcHVwUHJvZmlsZS5vcGVuUG9wdXAoKTtcclxufSk7XHJcblxyXG5jb25zdCBwb3B1cEF2YXRhciA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3BvcHVwLWF2YXRhclwiLCAoaW5wdXRWYWx1ZXMpID0+IHtcclxuICAgIGFwaS5lZGl0QXZhdGFyKGlucHV0VmFsdWVzLmF2YXRhcilcclxuICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBuZXdVc2VySW5mby5zZXRVc2VyQXZhdGFyKGRhdGEuYXZhdGFyKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5cclxucG9wdXBBdmF0YXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmJ1dHRvbkVkaXRBdmF0YXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHBvcHVwQXZhdGFyLm9wZW5Qb3B1cCgpO1xyXG59KTtcclxuXHJcbi8vb2J0ZW5lciBjYXJ0YXMgY29uIGxhIGFwaSB5IGFncmVnYXJsYXMgZW4gbGEgaW5zdGFuY2lhIGRlIFNlY3Rpb25cclxuXHJcbmFwaS5nZXRDYXJkcygpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIHNlY3Rpb25DYXJkcy5pdGVtcyA9IGRhdGE7XHJcbiAgICAgICAgc2VjdGlvbkNhcmRzLnJlbmRlckl0ZW1zKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSk7XHJcblxyXG5jb25zdCBzZWN0aW9uQ2FyZHMgPSBuZXcgU2VjdGlvbihcclxuICAgIHtcclxuICAgICAgICBpdGVtczogW10sXHJcbiAgICAgICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0NhcmQgPSBuZXcgQ2FyZCh7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBpdGVtLFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlQ2xpY2tJbWFnZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvcHVwSW1hZ2Uub3BlblBvcHVwKHsgbmFtZTogaXRlbS5uYW1lLCBsaW5rOiBpdGVtLmxpbmsgfSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlQ2xpY2tEZWxldGU6IChjYXJkSWQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBwb3B1cERlbGV0ZUNhcmQub3BlblBvcHVwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9wdXBEZWxldGVDYXJkLnNldEFjdGlvbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5kZWxldGVDYXJkKGNhcmRJZCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDYXJkLnJlbW92ZUNhcmQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVwRGVsZXRlQ2FyZC5jbG9zZVBvcHVwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZUxpa2VzOiAoY2FyZElkLCBpc0xpa2VkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaS50b2dnbGVMaWtlKGNhcmRJZCwgaXNMaWtlZCkudGhlbigocmVzKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDYXJkLnRvZ2dsZUxpa2UocmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB1c2VySWQ6IG5ld1VzZXJJbmZvLnVzZXJJZCxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHNlY3Rpb25DYXJkcy5hZGRDYXJkKG5ld0NhcmQuc2V0Q2FyZCgpKTtcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIFwiLmNhcmRzXCJcclxuKTtcclxuXHJcbi8vaW5zdGFuY2lhIGRlIGNyZWFjacOzbiBkZSBjYXJ0YXMgY29uIGZvcm11bGFyaW9cclxuXHJcbmNvbnN0IHBvcHVwQ2FyZCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3BvcHVwLWNhcmRcIiwgKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBhcGkuY3JlYXRlQ2FyZChpbnB1dFZhbHVlcy50aXRsZSwgaW5wdXRWYWx1ZXMubGluaylcclxuICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdDYXJkID0gbmV3IENhcmQoe1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZUNsaWNrSW1hZ2U6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBwb3B1cEltYWdlLm9wZW5Qb3B1cChkYXRhLm5hbWUsIGRhdGEubGluayk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlQ2xpY2tEZWxldGU6IChpZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvcHVwRGVsZXRlQ2FyZC5vcGVuUG9wdXAoKTtcclxuICAgICAgICAgICAgICAgICAgICBwb3B1cERlbGV0ZUNhcmQuc2V0QWN0aW9uKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmRlbGV0ZUNhcmQoaWQpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2FyZC5yZW1vdmVDYXJkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1cERlbGV0ZUNhcmQuY2xvc2VQb3B1cCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBoYW5kbGVMaWtlczogKGlkLCBpc0xpa2VkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaS50b2dnbGVMaWtlKGlkLCBpc0xpa2VkKS50aGVuKChyZXMpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NhcmQudG9nZ2xlTGlrZShyZXMubGlrZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHVzZXJJZDogbmV3VXNlckluZm8udXNlcklkLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2VjdGlvbkNhcmRzLmFkZENhcmQobmV3Q2FyZC5zZXRDYXJkKCkpO1xyXG4gICAgICAgICAgICBwb3B1cENhcmQuY2xvc2VQb3B1cCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKCgpID0+IGNvbnNvbGUubG9nKFwiZXJyb3IgYWwgY3JlYXIgY2FydGFcIikpO1xyXG59KTtcclxuXHJcbmNvbnN0IHBvcHVwRGVsZXRlQ2FyZCA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXCIjcG9wdXAtZGVsZXRlQ2FyZFwiKTtcclxucG9wdXBEZWxldGVDYXJkLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5wb3B1cENhcmQuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYnV0dG9uQWRkQ2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgcG9wdXBDYXJkLm9wZW5Qb3B1cCgpO1xyXG59KTtcclxuXHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjcG9wdXAtaW1hZ2VcIik7XHJcbnBvcHVwSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vaW5zdGFuY2lhcyBkZWwgdmFsaWRhZG9yIGRlIGZvcm11bGFyaW9zXHJcblxyXG5jb25zdCB2YWxpZGF0aW9ucHJvZmlsZSA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Qcm9maWxlLCBzZXR0aW5ncyk7XHJcbmNvbnN0IHZhbGlkYXRpb25BZGRDYXJkcyA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1BZGRDYXJkLCBzZXR0aW5ncyk7XHJcbmNvbnN0IHZhbGlkYXRpb25FZGl0QXZhdGFyID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUVkaXRBdmF0YXIsIHNldHRpbmdzKTtcclxudmFsaWRhdGlvbnByb2ZpbGUuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG52YWxpZGF0aW9uQWRkQ2FyZHMuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG52YWxpZGF0aW9uRWRpdEF2YXRhci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiJdLCJuYW1lcyI6WyJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiQ2FyZCIsIl9yZWYiLCJkYXRhIiwiaGFuZGxlQ2xpY2tJbWFnZSIsImhhbmRsZUNsaWNrRGVsZXRlIiwiaGFuZGxlTGlrZXMiLCJ1c2VySWQiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwibmFtZSIsImxpbmsiLCJvd25lciIsImxpa2VzIiwiaXNMaWtlZCIsImlzTGlrZWRCeVVzZXIiLCJpZCIsIl9pZCIsInNldFByb3BlcnRpZXMiLCJrZXkiLCJ2YWx1ZSIsImNsb25lTm9kZSIsImh0bWxDYXJkIiwiZ2V0VGVtcGxhdGUiLCJjYXJkSW1hZ2UiLCJjYXJkVGl0bGUiLCJidXR0b25MaWtlQ2FyZCIsImJ1dHRvbkRlbGV0ZUNhcmQiLCJjb3VudGVyTGlrZXMiLCJ0ZXh0Q29udGVudCIsInNyYyIsImxlbmd0aCIsInVwZGF0ZUxpa2VCdXR0b24iLCJzdHlsZSIsImRpc3BsYXkiLCJfdGhpcyIsInNvbWUiLCJsaWtlIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwicmVtb3ZlIiwiX3RoaXMyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRoZW4iLCJyZXMiLCJ0b2dnbGVMaWtlIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJldnQiLCJjbG9zZVBvcFVwSW1hZ2UiLCJwb3B1cCIsInRhcmdldCIsIl90aGlzMyIsInBvcFVwSW1hZ2UiLCJwb3BVcEltYWdlU3JjIiwiUG9wVXBUaXRsZUltYWdlIiwiYWRkIiwiY2xvc2VPbkVzYyIsImJpbmQiLCJjbG9zZUNsaWNrT3V0Rm9ybSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIkZvcm1WYWxpZGF0b3IiLCJmb3JtRWxlbWVudCIsInNldHRpbmdzIiwiaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJidXR0b25FbGVtZW50Iiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJjb25jYXQiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhpZGVJbnB1dEVycm9yIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiZm9yRWFjaCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInByZXZlbnREZWZhdWx0IiwiZm9ybVNlbGVjdG9yIiwiZm9ybVByb2ZpbGUiLCJ0ZXh0VGl0bGVQcm9maWxlIiwidGV4dFN1YnRpdGxlUHJvZmlsZSIsImF2YXRhciIsImZvcm1FZGl0QXZhdGFyIiwiZm9ybUFkZENhcmQiLCJidXR0b25FZGl0UHJvZmlsZSIsImJ1dHRvbkFkZENhcmQiLCJidXR0b25FZGl0QXZhdGFyIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwicG9wdXBFbGVtZW50IiwiY2xvc2VCdXR0b24iLCJfaGFuZGxlRXNDbG9zZSIsImNsb3NlUG9wdXAiLCJjb250YWlucyIsImhhbmRsZUNsaWNrT3V0c2lkZSIsIlBvcHVwV2l0aEZvcm0iLCJfUG9wdXAiLCJoYW5kbGVGb3JtU3VibWl0IiwiX2NhbGxTdXBlciIsImJ1dHRvblN1Ym1pdCIsIl9pbmhlcml0cyIsImZvcm1WYWx1ZXMiLCJpbnB1dCIsIl9zdXBlclByb3BHZXQiLCJnZXRJbnB1dFZhbHVlcyIsInJlc2V0IiwiUG9wdXBXaXRoSW1hZ2UiLCJpbWFnZUVsZW1lbnQiLCJ0aXRsZUVsZW1lbnQiLCJ0aXRsZSIsIlVzZXJJbmZvIiwiYWJvdXQiLCJpbnB1dE5hbWUiLCJpbnB1dEFib3V0IiwiaW5wdXRBdmF0YXIiLCJTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiaXNBcnJheSIsImNvbnRhaW5lciIsIml0ZW0iLCJlbGVtZW50IiwiYXBwZW5kIiwiYXBpIiwiQXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJmZXRjaCIsIm1ldGhvZCIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJfb2JqZWN0U3ByZWFkIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjYXJkSWQiLCJpc2xpa2VkIiwiZGlzbGlrZUNhcmQiLCJsaWtlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJQb3B1cFdpdGhDb25maXJtYXRpb24iLCJhY3Rpb24iLCJjb25maXJtQnV0dG9uIiwibmV3VXNlckluZm8iLCJnZXRVc2VyIiwic2V0VXNlckluZm8iLCJzZXRVc2VyQXZhdGFyIiwibG9nIiwicG9wdXBQcm9maWxlIiwiaW5wdXRWYWx1ZXMiLCJlZGl0VXNlciIsIm9wZW5Qb3B1cCIsInBvcHVwQXZhdGFyIiwiZWRpdEF2YXRhciIsImdldENhcmRzIiwic2VjdGlvbkNhcmRzIiwicmVuZGVySXRlbXMiLCJuZXdDYXJkIiwicG9wdXBJbWFnZSIsInBvcHVwRGVsZXRlQ2FyZCIsInNldEFjdGlvbiIsImRlbGV0ZUNhcmQiLCJyZW1vdmVDYXJkIiwiYWRkQ2FyZCIsInNldENhcmQiLCJwb3B1cENhcmQiLCJjcmVhdGVDYXJkIiwidmFsaWRhdGlvbnByb2ZpbGUiLCJ2YWxpZGF0aW9uQWRkQ2FyZHMiLCJ2YWxpZGF0aW9uRWRpdEF2YXRhciIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9